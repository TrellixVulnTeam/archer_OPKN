---
- name: Generate a merged list of locales
  set_fact:
    merged_locales:
      - "{{ locale.lang }}"
      - "{{ locale.locales }}"
  when:
    - locale.enabled == true
  tags:
    - chroot

- name: Generate system locales
  locale_gen:
    name: "{{ item }}"
    state: present
  with_items: "{{ merged_locales | unique | sort() }}"
  when:
    - locale.enabled == true
  tags:
    - chroot

- name: Apply template for /etc/locale.conf
  template:
    src: locale.conf.j2
    dest: /etc/locale.conf
    mode: 0644
  when:
    - locale.enabled == true
  tags:
    - chroot
